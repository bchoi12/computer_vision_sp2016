
#include <stdio.h>
#include <fstream>
#include <string>

#define DEBUG 1
#define END_HEADER "end_header"

int main(int argc, char** argv) {
  if (argc < 2) {
    printf("Usage: bin2ascii fname\n  fname: input ply in binary format");
    exit(1);
  }

  std::string inputFile = argv[1];
  if (inputFile.substr(inputFile.find_last_of('.')+1) != "ply") {
    printf("Error: expected ply file");
    exit(2);
  }
  
  std::ifstream ifs(inputFile);

  std::string outputFile = inputFile.substr(0, inputFile.find_last_of('.')) + "_ascii.ply";
  std::ofstream ofs(outputFile);
  
  if (ifs.is_open()) {
    if (DEBUG) {
      printf("Converting " + inputFile + " to " + outputFile);
    }

    std::string line;
    do {
      std::getline(ifs, line);
      ofs << line;
    }
    while(line != END_HEADER);
  }
}

